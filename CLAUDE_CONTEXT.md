# WhatNote é¡¹ç›®ä¸Šä¸‹æ–‡

## é¡¹ç›®æ¦‚è¿°

WhatNote æ˜¯ä¸€ä¸ªåŸºäº React å‰ç«¯å’Œ FastAPI åç«¯çš„æ™ºèƒ½å­¦ä¹ ç¬”è®°åº”ç”¨ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ PDF é˜…è¯»ã€AI ç¬”è®°ç”Ÿæˆã€ä¸“å®¶LLMæ™ºèƒ½é—®ç­”å’Œå±•æ¿ç®¡ç†ç­‰ã€‚

## ğŸš¨ å…³é”®ä¿®å¤é˜¶æ®µè®°å½•ï¼ˆ2025å¹´5æœˆï¼‰

### é˜¶æ®µ1: å±•æ¿éš”ç¦»é—®é¢˜ä¿®å¤

**é—®é¢˜æè¿°ï¼š** æ–°åˆ›å»ºçš„å±•æ¿ä¼šè‡ªåŠ¨åŒ…å«ä¹‹å‰å…¶ä»–å±•æ¿çš„PDFæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç©ºç™½çŠ¶æ€ã€‚

**æ ¹æœ¬åŸå› ï¼š** App.jsä¸­é”™è¯¯åœ°å°†è¯¾ç¨‹æ–‡ä»¶IDï¼ˆå¦‚`file-course-9-1`ï¼‰å½“ä½œå±•æ¿IDä½¿ç”¨ï¼Œå¯¼è‡´ï¼š
- è¯¾ç¨‹æ–‡ä»¶IDè¢«è¯¯è®¤ä¸ºå±•æ¿ID
- åç«¯ä¸ºè™šå‡å±•æ¿IDåˆ›å»ºæ—¥å¿—æ–‡ä»¶
- è¿™äº›æ—¥å¿—åŒ…å«ä¹‹å‰çš„PDFä½¿ç”¨æ•°æ®
- æ–°å±•æ¿æ˜¾ç¤ºæ—§PDFå†…å®¹è€Œéç©ºç™½çŠ¶æ€

**è§£å†³æ–¹æ¡ˆï¼š**
1. **å‰ç«¯ä¿®å¤** (`frontend/src/App.js`)ï¼š
   - æ·»åŠ è¯¾ç¨‹æ–‡ä»¶åˆ°å±•æ¿IDçš„æ˜ å°„ç³»ç»Ÿ
   - å®ç°`courseFileBoardMap`çŠ¶æ€ç®¡ç†
   - åˆ›å»º`getBoardIdForCourseFile`å‡½æ•°å¤„ç†IDè½¬æ¢

2. **åç«¯æ¸…ç†** (`board_isolation_fix.py`)ï¼š
   - æ¸…ç†è™šå‡å±•æ¿IDçš„æ—¥å¿—æ–‡ä»¶
   - ç§»é™¤æ ¼å¼ä¸º`file-course-*`çš„å±•æ¿æ—¥å¿—

**éªŒè¯ç»“æœï¼š** æ–°åˆ›å»ºå±•æ¿æ­£ç¡®æ˜¾ç¤ºç©ºç™½çŠ¶æ€ï¼ˆ0ä¸ªPDFï¼Œ0ä¸ªçª—å£ï¼‰

### é˜¶æ®µ2: React Hooksé”™è¯¯ä¿®å¤

**é—®é¢˜æè¿°ï¼š** 
```
ERROR [eslint] src\App.js Line 98:53: React Hook "useState" cannot be called at the top level
Warning: Invalid hook call. Hooks can only be called inside of the body of a function component
```

**æ ¹æœ¬åŸå› ï¼š** `useState`è°ƒç”¨å’Œç›¸å…³å‡½æ•°è¢«é”™è¯¯åœ°æ”¾ç½®åœ¨Appç»„ä»¶å¤–éƒ¨ï¼ˆç¬¬97-119è¡Œï¼‰

**è§£å†³æ–¹æ¡ˆï¼š** å°†ä»¥ä¸‹å†…å®¹ç§»å…¥Appç»„ä»¶å†…éƒ¨ï¼š
- `courseFileBoardMap`çŠ¶æ€
- `getBoardIdForCourseFile`å‡½æ•°
- æ‰€æœ‰ç›¸å…³çš„hooksè°ƒç”¨

**æŠ€æœ¯è¦ç‚¹ï¼š**
- React hookså¿…é¡»åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨è°ƒç”¨
- çŠ¶æ€ç®¡ç†å‡½æ•°å¿…é¡»åœ¨ç»„ä»¶ä½œç”¨åŸŸå†…
- æ­£ç¡®çš„ç»„ä»¶ç»“æ„å¯¹Reactç¼–è¯‘è‡³å…³é‡è¦

### é˜¶æ®µ3: PDFå°ºå¯¸å“åº”é—®é¢˜ä¿®å¤

**é—®é¢˜æè¿°ï¼š** PDFæŸ¥çœ‹å™¨çª—å£æ‹–æ‹½å˜å¤§æ—¶ï¼ŒPDFå†…å®¹æ˜¾ç¤ºèŒƒå›´åœ¨è¾¾åˆ°æŸä¸ªå°ºå¯¸åå°±ä¸å†ç»§ç»­æ‰©å¤§ã€‚

**æ ¹æœ¬åŸå› ï¼š** `PDFViewer.js`ä¸­ç¡¬ç¼–ç äº†900åƒç´ çš„æœ€å¤§å®½åº¦é™åˆ¶ï¼š
```javascript
width={containerRef.current ? Math.min(containerRef.current.offsetWidth - 30, 900) : 800}
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **åŠ¨æ€å®¹å™¨å®½åº¦è·Ÿè¸ª**ï¼š
   - æ·»åŠ `containerWidth`çŠ¶æ€
   - ä½¿ç”¨`ResizeObserver` APIç›‘å¬å®¹å™¨å¤§å°å˜åŒ–
   - æ·»åŠ çª—å£resizeäº‹ä»¶ç›‘å¬ä½œä¸ºå¤‡é€‰

2. **æ™ºèƒ½å°ºå¯¸é™åˆ¶**ï¼š
   ```javascript
   const minWidth = 300;  // æœ€å°å®½åº¦ï¼Œç¡®ä¿å¯è¯»æ€§
   const maxWidth = 1200; // æœ€å¤§å®½åº¦ï¼Œé¿å…è¿‡å¤§
   newWidth = Math.max(minWidth, Math.min(newWidth, maxWidth));
   ```

3. **CSSæ ·å¼ä¼˜åŒ–**ï¼š
   - ä¼˜åŒ–`.pdf-content`ã€`.pdf-document`ã€`.pdf-page`æ ·å¼
   - ç¡®ä¿100%å®½åº¦å“åº”æ€§
   - ä½¿ç”¨`!important`ç¡®ä¿æ ·å¼ä¼˜å…ˆçº§

**æŠ€æœ¯ç‰¹æ€§ï¼š**
- ä½¿ç”¨`ResizeObserver`è¿›è¡Œé«˜æ€§èƒ½ç›‘å¬
- 100msé˜²æŠ–æœºåˆ¶é¿å…é¢‘ç¹æ›´æ–°
- å®Œå…¨å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒ300-1200åƒç´ èŒƒå›´

**æ–‡æ¡£è®°å½•ï¼š** è¯¦ç»†æŠ€æœ¯å®ç°è®°å½•åœ¨`PDFå°ºå¯¸å“åº”ä¿®å¤æ€»ç»“.md`

## æœ€æ–°åŠŸèƒ½æ›´æ–°ï¼ˆ2024å¹´ï¼‰

### ğŸ”§ è°ƒè¯•é¢æ¿è¯·æ±‚ä½“ç±»å‹æ˜¾ç¤ºåŠŸèƒ½

**å®ç°ä½ç½®ï¼š** `frontend/src/components/LLMDebugPanel.js`

**åŠŸèƒ½æè¿°ï¼š**
- åœ¨LLMè°ƒè¯•é¢æ¿ä¸­æ˜¾ç¤ºè¯¦ç»†çš„è¯·æ±‚ç±»å‹ä¿¡æ¯
- æ”¯æŒä»¥ä¸‹è¯·æ±‚ç±»å‹çš„å¯è§†åŒ–æ ‡è¯†ï¼š
  - ğŸŸ  **æµå¼** (stream) - WebSocketå®æ—¶æµå¼è¾“å‡º
  - ğŸŸ£ **å›¾åƒ** (vision) - å›¾åƒç†è§£å’Œåˆ†æ
  - ğŸ”µ **æ”¹è¿›** (improve_annotation) - æ³¨é‡Šæ”¹è¿›åŠŸèƒ½
  - ğŸŸ¡ **è§†è§‰è¯†åˆ«** (vision_annotation) - å›¾åƒè¯†åˆ«æ³¨é‡Š
  - ğŸ”µ **æ™ºèƒ½** (intelligent) - æ™ºèƒ½ä¸“å®¶æ¨¡å¼
  - âšª **æ™®é€š** (normal) - å¸¸è§„æ–‡æœ¬å¤„ç†

**å®ç°ç»†èŠ‚ï¼š**
```javascript
// LLMç±»å‹åˆ—æ¸²æŸ“é€»è¾‘
render: (text, record) => {
  const llmType = text || 'unknown';
  const requestType = record.metadata?.requestType || 
                     record.metadata?.operation || 
                     (record.metadata?.streaming ? 'stream' : 'normal');
  
  return (
    <div>
      <Tag color={llmType === 'expert' ? 'blue' : 'green'}>
        {llmType === 'expert' ? 'ä¸“å®¶LLM' : 'ç®¡å®¶LLM'}
      </Tag>
      <br />
      <Tag size="small" color={/* æ ¹æ®requestTypeè®¾ç½®é¢œè‰² */}>
        {/* æ ¹æ®requestTypeæ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾ */}
      </Tag>
    </div>
  );
}
```

**æ—¥å¿—è®°å½•å¢å¼ºï¼š**
- å›¾åƒè¯†åˆ«ï¼š`metadata.requestType = 'vision_annotation'`
- æ”¹è¿›æ³¨é‡Šï¼š`metadata.requestType = 'improve_annotation'`
- æ™ºèƒ½æ¨¡å¼ï¼š`metadata.requestType = 'intelligent'`

### ğŸ§  ä¸“å®¶LLMç»Ÿä¸€æ™ºèƒ½æ¨¡å¼

**æ ¸å¿ƒæ”¹è¿›ï¼š** æ‰€æœ‰ä¸“å®¶LLMæ“ä½œç»Ÿä¸€ä½¿ç”¨æ™ºèƒ½æ¨¡å¼ï¼Œå¹¶å®æ—¶æ˜¾ç¤ºæ‰§è¡Œæ­¥éª¤

**åç«¯å®ç°ï¼š** `main.py` - `/api/expert/stream` WebSocketç«¯ç‚¹

**ä¸»è¦å˜åŒ–ï¼š**
```python
# ä¿®æ”¹å‰ï¼šä½¿ç”¨æ™®é€šä¸“å®¶LLM
expert = get_expert_llm(board_id)
full_response = expert.stream_call_llm(query, callback)

# ä¿®æ”¹åï¼šä½¿ç”¨æ™ºèƒ½ä¸“å®¶ç³»ç»Ÿ
intelligent_expert = IntelligentExpert(board_id)
full_response = await intelligent_expert.process_query(query, status_callback)
```

**æ­¥éª¤æ˜¾ç¤ºåŠŸèƒ½ï¼š**
- WebSocketå®æ—¶æ¨é€æ­¥éª¤è¿›åº¦
- å‰ç«¯æ˜¾ç¤ºç¾è§‚çš„æ­¥éª¤åŠ¨ç”»
- æ”¯æŒä»¥ä¸‹æ­¥éª¤ç±»å‹ï¼š
  - ğŸš€ å¯åŠ¨æ™ºèƒ½ä¸“å®¶åˆ†æç³»ç»Ÿ
  - ğŸ” å¼€å§‹åˆ†ææŸ¥è¯¢
  - ğŸ¤” å¤šè½®åˆ†æå’Œä¿¡æ¯æ”¶é›†
  - ğŸ”§ è°ƒç”¨å·¥å…·ï¼ˆå¦‚list_board_filesã€get_pdf_pageç­‰ï¼‰
  - âœ… æ™ºèƒ½åˆ†æå®Œæˆ

**å‰ç«¯æ­¥éª¤å¤„ç†ï¼š** `frontend/src/components/BoardExpertPanel.js`

```javascript
// WebSocketæ¶ˆæ¯å¤„ç†
if (data.step) {
  const stepMessage = {
    role: 'system',
    content: `ğŸ”§ [è¿›åº¦] ${data.step}`,
    isStep: true,
    timestamp: new Date().toISOString()
  };
  // æ’å…¥åˆ°æ¶ˆæ¯åˆ—è¡¨
}
```

**CSSåŠ¨ç”»æ•ˆæœï¼š** `frontend/src/components/NoteWindow.css`

```css
/* è„‰å†²åŠ¨ç”» */
@keyframes pulse {
  0% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.6; transform: scale(1.2); }
  100% { opacity: 1; transform: scale(1); }
}

/* æ»‘å…¥åŠ¨ç”» */
@keyframes slideInLeft {
  from { opacity: 0; transform: translateX(-20px); }
  to { opacity: 1; transform: translateX(0); }
}
```

## æ ¸å¿ƒæ¶æ„ç»„ä»¶

### åç«¯æ¶æ„

#### 1. ä¸»åº”ç”¨ (`main.py`)
- **æ ¸å¿ƒèŒè´£ï¼š** FastAPIåº”ç”¨å…¥å£ï¼Œè·¯ç”±å®šä¹‰ï¼ŒWebSocketç«¯ç‚¹
- **é‡è¦ç«¯ç‚¹ï¼š**
  - `/api/expert/stream` - ä¸“å®¶LLMæ™ºèƒ½WebSocketï¼ˆğŸ†• ç»Ÿä¸€æ™ºèƒ½æ¨¡å¼ï¼‰
  - `/api/materials/{filename}/pages/{page_number}/annotate` - é¡µé¢æ³¨é‡Šç”Ÿæˆ
  - `/api/expert/dynamic/*` - åŠ¨æ€ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

#### 2. æ™ºèƒ½ä¸“å®¶ç³»ç»Ÿ (`intelligent_expert.py`)
- **æ ¸å¿ƒåŠŸèƒ½ï¼š** Function Callingæ¨¡å¼ï¼Œå¤šè½®å¯¹è¯ï¼Œå·¥å…·è°ƒç”¨
- **æ”¯æŒå·¥å…·ï¼š**
  - `list_board_files` - åˆ—å‡ºå±•æ¿æ–‡ä»¶
  - `get_pdf_page` - è·å–PDFé¡µé¢å†…å®¹
  - `get_pdf_info` - è·å–PDFä¿¡æ¯
  - `search_pdf_content` - æœç´¢PDFå†…å®¹

#### 3. ä¸“å®¶LLM (`expert_llm.py`)
- **åŠ¨æ€ä»»åŠ¡æ”¯æŒï¼š** æ”¯æŒvision_annotationå’Œimprove_annotationä»»åŠ¡ç±»å‹
- **å¹¶å‘ç®¡ç†ï¼š** ä»»åŠ¡çŠ¶æ€è·Ÿè¸ªå’Œè¶…æ—¶å¤„ç†

#### 4. æ§åˆ¶å™¨ (`controller.py`)
- **é¡µé¢å¤„ç†ï¼š** PDFé¡µé¢æ³¨é‡Šï¼Œå›¾åƒè¯†åˆ«ç»“æœä¿å­˜

### å‰ç«¯æ¶æ„

#### 1. ä¸»åº”ç”¨ (`frontend/src/App.js`)
- **å›¾åƒè¯†åˆ«ï¼š** `handleForceVisionAnnotate` - ä½¿ç”¨åŠ¨æ€ä»»åŠ¡API
- **æ”¹è¿›æ³¨é‡Šï¼š** `handleImproveAnnotation` - å‚æ•°é¡ºåºä¿®å¤ï¼Œè¯·æ±‚ä½“è®°å½•
- **æ—¥å¿—è®°å½•ï¼š** å®Œæ•´çš„LLMäº¤äº’æ—¥å¿—ï¼ŒåŒ…å«è¯·æ±‚ä½“å’Œå…ƒæ•°æ®

#### 2. ä¸“å®¶LLMé¢æ¿ (`frontend/src/components/BoardExpertPanel.js`)
- **æ­¥éª¤æ˜¾ç¤ºï¼š** å®æ—¶WebSocketæ­¥éª¤æ¶ˆæ¯å¤„ç†
- **æ™ºèƒ½æ¨¡å¼ï¼š** ç»Ÿä¸€ä½¿ç”¨æ™ºèƒ½åˆ†æï¼Œç§»é™¤æ™®é€š/æ™ºèƒ½æ¨¡å¼åˆ‡æ¢
- **è§†è§‰æ•ˆæœï¼š** æ­¥éª¤è¿›åº¦åŠ¨ç”»ï¼Œè„‰å†²æŒ‡ç¤ºå™¨

#### 3. è°ƒè¯•é¢æ¿ (`frontend/src/components/LLMDebugPanel.js`)
- **è¯·æ±‚ç±»å‹æ˜¾ç¤ºï¼š** å¯è§†åŒ–æ ‡ç­¾ç³»ç»Ÿ
- **è¯·æ±‚ä½“è¯¦æƒ…ï¼š** JSONæ ¼å¼ç¾åŒ–æ˜¾ç¤º
- **å“åº”å†…å®¹ï¼š** Markdownæ¸²æŸ“æ”¯æŒ

## é‡è¦æ³¨æ„äº‹é¡¹ä¸é¿å…ç ´ååŠŸèƒ½çš„æŒ‡å—

### âš ï¸ å…³é”®æ–‡ä»¶ä¿®æ”¹æ³¨æ„äº‹é¡¹

#### 1. å‰ç«¯JavaScriptæ–‡ä»¶æ ¼å¼
**é—®é¢˜ï¼š** JavaScriptä»£ç è¢«å‹ç¼©æˆä¸€è¡Œå¯¼è‡´è¯­æ³•é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
- å§‹ç»ˆä¿æŒä»£ç æ ¼å¼åŒ–ï¼Œé¿å…å‹ç¼©æˆä¸€è¡Œ
- ä½¿ç”¨é€‚å½“çš„ä»£ç ç¼–è¾‘å™¨å’Œæ ¼å¼åŒ–å·¥å…·
- ä¿®æ”¹JavaScriptæ—¶æ£€æŸ¥è¯­æ³•æ­£ç¡®æ€§

**å±é™©æ“ä½œï¼š**
```javascript
// âŒ é”™è¯¯ï¼šå‹ç¼©æˆä¸€è¡Œ
{title:'LLMç±»å‹',dataIndex:'llmType',render:(text,record)=>{const llmType=text||'unknown';return(<Tag>{llmType}</Tag>);},},

// âœ… æ­£ç¡®ï¼šæ ¼å¼åŒ–ä»£ç 
{
  title: 'LLMç±»å‹',
  dataIndex: 'llmType',
  render: (text, record) => {
    const llmType = text || 'unknown';
    return <Tag>{llmType}</Tag>;
  },
},
```

#### 2. WebSocketç«¯ç‚¹ä¿®æ”¹
**å…³é”®æ–‡ä»¶ï¼š** `main.py` - `/api/expert/stream`

**æ³¨æ„äº‹é¡¹ï¼š**
- ä¿æŒWebSocketæ¶ˆæ¯æ ¼å¼ä¸€è‡´æ€§
- ç¡®ä¿æ­¥éª¤å›è°ƒå‡½æ•°æ­£ç¡®ä¼ é€’
- ç»´æŠ¤æ™ºèƒ½ä¸“å®¶ç³»ç»Ÿçš„å¼‚æ­¥å¤„ç†

**æ¶ˆæ¯æ ¼å¼æ ‡å‡†ï¼š**
```python
# æ­¥éª¤è¿›åº¦æ¶ˆæ¯
await websocket.send_json({
    "step": "ğŸ”§ æ‰§è¡Œæ­¥éª¤æè¿°",
    "timestamp": time.time()
})

# å®Œæˆä¿¡å·
await websocket.send_json({
    "done": True,
    "full_response": response,
    "intelligent_mode": True
})
```

#### 3. æ—¥å¿—è®°å½•ç³»ç»Ÿ
**å…³é”®æ–‡ä»¶ï¼š** `frontend/src/App.js`

**å…ƒæ•°æ®æ ¼å¼è¦æ±‚ï¼š**
```javascript
metadata: {
  operation: 'improve_annotation',
  requestType: 'improve_annotation',  // å…³é”®å­—æ®µï¼Œç”¨äºè°ƒè¯•é¢æ¿æ˜¾ç¤º
  streaming: false,
  taskBased: true,
  boardId: boardId  // å¯é€‰
}
```

### ğŸ”„ åŠŸèƒ½æµ‹è¯•éªŒè¯

#### 1. æ™ºèƒ½ä¸“å®¶ç³»ç»Ÿæµ‹è¯•
**æµ‹è¯•æ–‡ä»¶ï¼š** `test_intelligent_expert_steps.py`

**éªŒè¯å†…å®¹ï¼š**
- æ­¥éª¤æ¶ˆæ¯æ•°é‡ â‰¥ 2
- æ™ºèƒ½æ¨¡å¼æ ‡è¯†æ­£ç¡®
- å·¥å…·è°ƒç”¨æ­¥éª¤æ˜¾ç¤º
- WebSocketæ¶ˆæ¯æ ¼å¼

#### 2. è°ƒè¯•é¢æ¿åŠŸèƒ½æµ‹è¯•
**éªŒè¯æ­¥éª¤ï¼š**
1. æ‰§è¡Œå„ç§LLMæ“ä½œï¼ˆå›¾åƒè¯†åˆ«ã€æ”¹è¿›æ³¨é‡Šã€æ™ºèƒ½é—®ç­”ï¼‰
2. æ£€æŸ¥è°ƒè¯•é¢æ¿æ˜¾ç¤ºçš„è¯·æ±‚ç±»å‹æ ‡ç­¾
3. éªŒè¯è¯·æ±‚ä½“è¯¦æƒ…æ˜¾ç¤º
4. ç¡®è®¤å“åº”å†…å®¹æ­£ç¡®æ¸²æŸ“

### ğŸš¨ å¸¸è§ç ´åæ€§æ“ä½œé¿å…

#### 1. ä¸è¦ä¿®æ”¹æ ¸å¿ƒæ¶ˆæ¯æ ¼å¼
```javascript
// âŒ é”™è¯¯ï¼šä¿®æ”¹æ­¥éª¤æ¶ˆæ¯ç»“æ„
if (data.step_info) { // ä¸è¦æ”¹å˜å­—æ®µå
  // ...
}

// âœ… æ­£ç¡®ï¼šä¿æŒç°æœ‰ç»“æ„
if (data.step) {
  // ...
}
```

#### 2. ä¸è¦ç§»é™¤å¿…è¦çš„metadataå­—æ®µ
```javascript
// âŒ é”™è¯¯ï¼šç¼ºå°‘requestType
metadata: {
  operation: 'improve_annotation'
  // ç¼ºå°‘ requestType å­—æ®µ
}

// âœ… æ­£ç¡®ï¼šåŒ…å«å®Œæ•´metadata
metadata: {
  operation: 'improve_annotation',
  requestType: 'improve_annotation',
  streaming: false,
  taskBased: true
}
```

#### 3. ä¸è¦ç ´åå¼‚æ­¥å¤„ç†é€»è¾‘
```python
# âŒ é”™è¯¯ï¼šç§»é™¤å¼‚æ­¥æ”¯æŒ
def process_query(self, query):  # ç§»é™¤äº†async
    # ...

# âœ… æ­£ç¡®ï¼šä¿æŒå¼‚æ­¥å¤„ç†
async def process_query(self, query, status_callback=None):
    # ...
```

### ğŸ”§ è°ƒè¯•æŠ€å·§

#### 1. å‰ç«¯è°ƒè¯•
- ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥WebSocketæ¶ˆæ¯
- æŸ¥çœ‹LLMè°ƒè¯•é¢æ¿çš„æ—¥å¿—è®°å½•
- éªŒè¯æ­¥éª¤åŠ¨ç”»æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

#### 2. åç«¯è°ƒè¯•
- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä¸­çš„æ™ºèƒ½ä¸“å®¶ç³»ç»Ÿè¾“å‡º
- éªŒè¯WebSocketè¿æ¥çŠ¶æ€
- ç¡®è®¤ä»»åŠ¡æ‰§è¡Œæµç¨‹

#### 3. é›†æˆæµ‹è¯•
- è¿è¡Œ`test_intelligent_expert_steps.py`éªŒè¯æ•´ä½“åŠŸèƒ½
- æ£€æŸ¥å‰åç«¯æ—¥å¿—ä¸€è‡´æ€§
- éªŒè¯ç”¨æˆ·ç•Œé¢å“åº”æ­£ç¡®

## æŠ€æœ¯æ ˆè¯¦æƒ…

### å‰ç«¯æŠ€æœ¯æ ˆ
- **React 18+** - æ ¸å¿ƒUIæ¡†æ¶
- **Ant Design** - UIç»„ä»¶åº“
- **WebSocket** - å®æ—¶é€šä¿¡
- **React-Markdown** - Markdownæ¸²æŸ“
- **Babel** - JavaScriptç¼–è¯‘å™¨

### åç«¯æŠ€æœ¯æ ˆ
- **FastAPI** - Webæ¡†æ¶
- **WebSocket** - å®æ—¶é€šä¿¡æ”¯æŒ
- **OpenAI API** - LLMé›†æˆ
- **PDFå¤„ç†** - æ–‡æ¡£è§£æ
- **å¼‚æ­¥å¤„ç†** - å¹¶å‘ä»»åŠ¡ç®¡ç†

### éƒ¨ç½²é…ç½®
- **å¼€å‘ç¯å¢ƒï¼š** npm start (å‰ç«¯) + python main.py (åç«¯)
- **ç«¯å£é…ç½®ï¼š** å‰ç«¯3000ï¼Œåç«¯8000
- **APIä»£ç†ï¼š** å‰ç«¯è¯·æ±‚ä»£ç†åˆ°åç«¯

## é¡¹ç›®æ–‡ä»¶ç»“æ„

```
whatnote/
â”œâ”€â”€ frontend/                         # Reactå‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ LLMDebugPanel.js      # ğŸ†• è°ƒè¯•é¢æ¿ï¼ˆè¯·æ±‚ç±»å‹æ˜¾ç¤ºï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ BoardExpertPanel.js   # ğŸ†• ä¸“å®¶é¢æ¿ï¼ˆæ­¥éª¤æ˜¾ç¤ºï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ PDFViewer.js          # ğŸ†• PDFå“åº”å¼æ˜¾ç¤ºç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ NoteWindow.css        # ğŸ†• æ­¥éª¤åŠ¨ç”»æ ·å¼
â”‚   â”‚   â””â”€â”€ App.js                    # ğŸ†• å±•æ¿éš”ç¦»ä¿®å¤ï¼Œæ—¥å¿—è®°å½•å¢å¼º
â”œâ”€â”€ main.py                           # ğŸ†• æ™ºèƒ½WebSocketç«¯ç‚¹
â”œâ”€â”€ intelligent_expert.py            # æ™ºèƒ½ä¸“å®¶ç³»ç»Ÿ
â”œâ”€â”€ expert_llm.py                     # ğŸ†• åŠ¨æ€ä»»åŠ¡æ”¯æŒ
â”œâ”€â”€ controller.py                     # PDFå¤„ç†å’Œæ³¨é‡Š
â”œâ”€â”€ board_isolation_fix.py            # å±•æ¿éš”ç¦»é—®é¢˜ä¿®å¤è„šæœ¬
â”œâ”€â”€ board_logger.py                   # å±•æ¿æ—¥å¿—ç®¡ç†
â”œâ”€â”€ board_manager.py                  # å±•æ¿ç®¡ç†å™¨
â”œâ”€â”€ butler_llm.py                     # ç®¡å®¶LLMç³»ç»Ÿ
â”œâ”€â”€ conversation_manager.py           # å¯¹è¯ç®¡ç†å™¨
â”œâ”€â”€ llm_agents.py                     # LLMä»£ç†ç³»ç»Ÿ
â”œâ”€â”€ llm_logger.py                     # LLMæ—¥å¿—è®°å½•
â”œâ”€â”€ config.py                         # é…ç½®ç®¡ç†
â”œâ”€â”€ requirements.txt                  # Pythonä¾èµ–
â”œâ”€â”€ package.json                      # Node.jsä¾èµ–
â”œâ”€â”€ CLAUDE_CONTEXT.md                 # ğŸ†• é¡¹ç›®ä¸Šä¸‹æ–‡æ–‡æ¡£
â”œâ”€â”€ PDFå°ºå¯¸å“åº”ä¿®å¤æ€»ç»“.md            # ğŸ†• PDFä¿®å¤æŠ€æœ¯æ–‡æ¡£
â”œâ”€â”€ ä¸´æ—¶æµ‹è¯•æ–‡ä»¶å¤‡ä»½/                 # ğŸ†• æµ‹è¯•æ–‡ä»¶å¤‡ä»½æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ README.md                     # å¤‡ä»½è¯´æ˜æ–‡æ¡£
â”‚   â””â”€â”€ [82ä¸ªæµ‹è¯•å’Œä¸´æ—¶æ–‡ä»¶]          # å·²ç§»åŠ¨çš„æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ test_intelligent_expert_steps.py # âœ… ä¿ç•™ï¼šæ™ºèƒ½ä¸“å®¶ç³»ç»Ÿæ­¥éª¤éªŒè¯
â”œâ”€â”€ test_intelligent_expert.py       # âœ… ä¿ç•™ï¼šæ™ºèƒ½ä¸“å®¶ç³»ç»ŸåŸºç¡€æµ‹è¯•
â”œâ”€â”€ test_improve_annotation.py       # âœ… ä¿ç•™ï¼šæ”¹è¿›æ³¨é‡ŠåŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_frontend_performance.py     # âœ… ä¿ç•™ï¼šå‰ç«¯æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ board_logs/                       # å±•æ¿æ—¥å¿—ç›®å½•
â”œâ”€â”€ llm_logs/                         # LLMæ—¥å¿—ç›®å½•
â”œâ”€â”€ uploads/                          # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ pages/                            # é¡µé¢æ–‡ä»¶ç›®å½•
â””â”€â”€ å„ç§ä¿®å¤æ€»ç»“æ–‡æ¡£.md               # å†å²ä¿®å¤è®°å½•æ–‡æ¡£
```

## ğŸ—‚ï¸ é¡¹ç›®æ–‡ä»¶æ¸…ç†è¯´æ˜ï¼ˆ2025å¹´5æœˆ25æ—¥ï¼‰

### æ¸…ç†ç›®æ ‡
ä¸ºäº†ä¿æŒé¡¹ç›®ç›®å½•æ•´æ´ï¼Œå°†82ä¸ªä¸´æ—¶æµ‹è¯•æ–‡ä»¶å’Œè°ƒè¯•è„šæœ¬ç§»åŠ¨åˆ°`ä¸´æ—¶æµ‹è¯•æ–‡ä»¶å¤‡ä»½/`æ–‡ä»¶å¤¹ä¸­ã€‚

### ä¿ç•™çš„é‡è¦æµ‹è¯•æ–‡ä»¶
- `test_intelligent_expert_steps.py` - æ™ºèƒ½ä¸“å®¶ç³»ç»Ÿæ­¥éª¤éªŒè¯ï¼ˆæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼‰
- `test_intelligent_expert.py` - æ™ºèƒ½ä¸“å®¶ç³»ç»ŸåŸºç¡€æµ‹è¯•
- `test_improve_annotation.py` - æ”¹è¿›æ³¨é‡ŠåŠŸèƒ½æµ‹è¯•
- `test_frontend_performance.py` - å‰ç«¯æ€§èƒ½æµ‹è¯•

### å·²å¤‡ä»½çš„æ–‡ä»¶ç±»å‹
1. **ä¸´æ—¶æµ‹è¯•æ–‡ä»¶** - å„ç§`test_*.py`è°ƒè¯•å’ŒéªŒè¯è„šæœ¬
2. **ä»£ç å¤‡ä»½** - `temp_main.py`, `main_backup.py`, `controller_*.py`ç­‰
3. **ä¿®å¤è„šæœ¬** - `fix_*.js`, `add_rename_api.py`ç­‰
4. **è°ƒè¯•é¡µé¢** - `test_rename_browser.html`ç­‰

### æ¢å¤æ–¹æ³•
å¦‚éœ€æ¢å¤ä»»ä½•æ–‡ä»¶ï¼Œå¯ä»`ä¸´æ—¶æµ‹è¯•æ–‡ä»¶å¤‡ä»½/`æ–‡ä»¶å¤¹ä¸­å¤åˆ¶å›ä¸»ç›®å½•ã€‚

## å¼€å‘æœ€ä½³å®è·µ

### 1. ä»£ç æäº¤å‰æ£€æŸ¥
- [ ] JavaScriptè¯­æ³•æ£€æŸ¥ï¼ˆé¿å…å‹ç¼©ä»£ç ï¼‰
- [ ] WebSocketæ¶ˆæ¯æ ¼å¼éªŒè¯
- [ ] å…ƒæ•°æ®å­—æ®µå®Œæ•´æ€§
- [ ] æµ‹è¯•è„šæœ¬æ‰§è¡Œé€šè¿‡

### 2. åŠŸèƒ½æ‰©å±•æŒ‡å—
- æ–°å¢è¯·æ±‚ç±»å‹æ—¶ï¼ŒåŒæ—¶æ›´æ–°LLMDebugPanel.jsçš„é¢œè‰²æ˜ å°„
- æ–°å¢æ­¥éª¤ç±»å‹æ—¶ï¼Œç¡®ä¿WebSocketæ¶ˆæ¯æ ¼å¼ä¸€è‡´
- æ–°å¢LLMæ“ä½œæ—¶ï¼Œè®°å½•å®Œæ•´çš„metadataä¿¡æ¯

### 3. æ€§èƒ½ä¼˜åŒ–æ³¨æ„
- WebSocketè¿æ¥å¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»º
- é•¿æ—¶é—´ä»»åŠ¡ä½¿ç”¨åŠ¨æ€ä»»åŠ¡API
- å¤§æ–‡ä»¶å¤„ç†ä½¿ç”¨æµå¼å¤„ç†

è¿™ä»½æ–‡æ¡£åº”è¯¥å¸®åŠ©åç»­å¼€å‘è€…ç†è§£é¡¹ç›®æ¶æ„ï¼Œé¿å…ç ´åç°æœ‰åŠŸèƒ½ï¼Œå¹¶æ­£ç¡®æ‰©å±•æ–°åŠŸèƒ½ã€‚ 