# WhatNote 功能使用指南

## 🚀 启动应用

### 1. 启动后端服务
```bash
# 在项目根目录下
python main.py
```
看到以下信息表示启动成功：
```
=== WhatNote 服务已启动 ===
API密钥配置: 已配置
视觉API配置: 已配置
=======================
```

### 2. 打开前端界面
在浏览器中访问：
- **主界面**: `http://127.0.0.1:8000/frontend_debug.html`
- **MCP测试界面**: `http://127.0.0.1:8000/mcp_test_frontend.html`

## 📚 核心功能使用

### 1. 课程管理

#### 创建课程文件夹
1. 在主界面左侧点击 **"+ 新建课程"**
2. 输入课程名称（如："高等数学"）
3. 点击确认创建

#### 上传PDF课件
1. 点击课程文件夹右侧的 **"+"** 按钮
2. 选择 **"上传PDF"**
3. 选择PDF文件并上传
4. 系统自动分页处理

### 2. 展板功能

#### 创建展板
1. 在主界面右侧点击 **"+ 新建展板"**
2. 输入展板名称（如："第一章学习笔记"）
3. 选择所属课程文件夹
4. 点击创建

#### 在展板中打开PDF
1. 从左侧课程文件夹拖拽PDF文件到展板
2. 或点击PDF文件，选择 **"在展板中打开"**
3. PDF会在展板中以窗口形式显示

### 3. AI注释功能

#### 生成页面注释
**方法一：自动注释**
1. 在PDF窗口中浏览到需要注释的页面
2. 点击页面下方的 **"生成AI注释"** 按钮
3. 等待AI分析并生成注释

**方法二：强制视觉识别**
1. 点击 **"视觉识别注释"** 按钮
2. 系统会使用图像识别技术分析页面
3. 适用于包含图表、公式的复杂页面

#### 改进注释
1. 在已有注释的基础上，点击 **"改进注释"**
2. 输入改进要求（如："请详细解释公式推导过程"）
3. AI会基于你的要求优化注释内容

### 4. 专家LLM智能问答

#### 使用MCP专家系统（推荐）
1. 在展板右下角找到 **"专家助手"** 面板
2. 在输入框中输入问题（如："请解释第5页的核心概念"）
3. 点击 **"智能分析"** 按钮
4. 系统会：
   - 自动分析展板内容
   - 调用相关工具获取信息
   - 提供详细的专业回答

#### 常用问题示例
```
- "请总结这个PDF的主要内容"
- "第3页的公式是什么意思？"
- "帮我找到包含'微分'关键词的页面"
- "请为这章内容创建学习笔记"
```

### 5. 管家LLM助手

#### 使用管家助手
1. 在主界面顶部找到 **"智能助手"** 输入框
2. 输入管理类问题（如："帮我整理课程文件"）
3. 管家助手会：
   - 分析当前文件结构
   - 提供管理建议
   - 执行文件操作命令

#### 管家助手功能
- 文件管理和整理
- 课程结构优化建议
- 学习进度跟踪
- 系统状态监控

## 🔧 高级功能

### 1. 并发处理

#### 同时处理多个任务
1. 在专家助手中提交第一个任务
2. 不等待完成，直接提交第二个任务
3. 系统会自动启动多个LLM实例并发处理

#### 查看任务状态
```javascript
// 在浏览器控制台中查看
fetch('/api/expert/dynamic/concurrent-status/your-board-id')
  .then(r => r.json())
  .then(console.log);
```

### 2. 实时调试

#### 查看LLM交互日志
1. 访问：`http://127.0.0.1:8000/api/llm-logs/recent`
2. 查看最近的LLM交互记录
3. 分析系统性能和问题

#### 查看展板状态
```bash
# 查看特定展板信息
curl http://127.0.0.1:8000/api/boards/your-board-id
```

### 3. MCP系统测试

#### 使用MCP测试界面
1. 打开：`http://127.0.0.1:8000/mcp_test_frontend.html`
2. 输入展板ID
3. 测试各种MCP功能：
   - 系统统计
   - 工具列表
   - 实时对话
   - 对话历史

## 📱 快捷操作

### 键盘快捷键
- `Ctrl + N`: 新建展板
- `Ctrl + U`: 上传文件
- `Ctrl + S`: 保存当前状态
- `F5`: 刷新展板内容

### 右键菜单
- 在PDF页面右键：生成注释、视觉识别、改进注释
- 在展板空白处右键：添加窗口、整理布局
- 在文件上右键：重命名、删除、移动

## 🔍 故障排除

### 常见问题

#### 1. API密钥未配置
**症状**: 无法生成注释，提示API错误
**解决**: 
1. 检查 `.env` 文件是否存在
2. 确认 `QWEN_API_KEY` 和 `QWEN_VL_API_KEY` 已设置
3. 重启服务

#### 2. PDF无法上传
**症状**: 上传失败或处理错误
**解决**:
1. 检查文件大小（限制50MB）
2. 确认文件格式为PDF
3. 检查磁盘空间

#### 3. 专家LLM无响应
**症状**: 提问后长时间无回应
**解决**:
1. 检查网络连接
2. 查看控制台错误信息
3. 重新创建展板

### 调试工具

#### 健康检查
```bash
curl http://127.0.0.1:8000/health
```

#### API连接测试
```bash
curl http://127.0.0.1:8000/api/test-connection
```

#### 查看系统日志
```bash
# 查看实时日志
tail -f logs/app.log
```

## 🎯 最佳实践

### 1. 高效学习流程
1. **准备阶段**: 创建课程文件夹，上传所有相关PDF
2. **学习阶段**: 为每个学习主题创建专门展板
3. **复习阶段**: 使用专家LLM生成总结和测试题
4. **整理阶段**: 用管家助手整理文件和笔记

### 2. 注释策略
- **简单文本页面**: 使用自动注释
- **包含图表的页面**: 使用视觉识别注释
- **复杂概念**: 先生成基础注释，再用改进功能深化

### 3. 问答技巧
- **具体问题**: "第5页的公式推导过程是什么？"
- **概念解释**: "请用简单的话解释这个定理"
- **应用场景**: "这个知识点在实际中如何应用？"

## 🚀 进阶使用

### 1. API直接调用
```python
import requests

# 生成注释
response = requests.post(
    'http://127.0.0.1:8000/api/materials/example.pdf/pages/1/annotate',
    json={'board_id': 'your-board-id'}
)

# 专家问答
response = requests.post(
    'http://127.0.0.1:8000/api/expert',
    json={
        'query': '请解释这个概念',
        'board_id': 'your-board-id'
    }
)
```

### 2. 批量处理
```python
# 批量生成PDF所有页面的注释
for page in range(1, total_pages + 1):
    requests.post(f'/api/materials/{filename}/pages/{page}/annotate')
```

### 3. 自定义工具开发
参考 `mcp_tools.py` 中的示例，开发自己的MCP工具：
```python
class MyCustomTool(MCPTool):
    def __init__(self):
        super().__init__("my_tool", "我的自定义工具")
    
    async def execute(self, **kwargs):
        # 实现你的工具逻辑
        return MCPToolResult(success=True, data="结果")
```

## 📞 获取帮助

### 文档资源
- **MCP系统**: 查看 `MCP_SYSTEM_README.md`
- **API文档**: 访问 `http://127.0.0.1:8000/docs`
- **更新日志**: 查看各种修复总结文档

### 调试信息
- **系统状态**: `http://127.0.0.1:8000/api/mcp/system-stats`
- **展板信息**: `http://127.0.0.1:8000/api/boards/list`
- **LLM日志**: `http://127.0.0.1:8000/api/llm-logs/recent`

记住：WhatNote是一个智能学习助手，善用AI功能可以大大提高学习效率！🎓 