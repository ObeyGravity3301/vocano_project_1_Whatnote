# WhatNote 控制台指令体系设计

## 🎯 设计目标

实现用户界面操作的完全指令化，让用户能够通过自然语言控制所有WhatNote功能。

## 🏗️ 架构原理

```
自然语言输入 → 管家LLM理解 → JSON Function Call → 前端执行 → 反馈结果
```

## 📚 指令分类体系

### 1. 文件管理类 (File Management)

#### 1.1 文件查看指令
```bash
# 自然语言示例
"列出所有PDF文件"
"显示我的课件文件"
"查看uploads目录"
"检查文件状态"

# Function Call 格式
{
  "type": "file_operation",
  "action": "list_files", 
  "params": {
    "file_type": "pdf" | "all",
    "directory": "uploads" | "pages" | "all"
  }
}
```

#### 1.2 文件上传指令
```bash
# 自然语言示例
"上传PDF文件"
"导入新课件"
"添加文档到系统"

# Function Call 格式
{
  "type": "file_operation",
  "action": "upload_file",
  "params": {
    "file_type": "pdf" | "pptx"
  }
}
```

#### 1.3 文件删除指令
```bash
# 自然语言示例
"删除文件 xxx.pdf"
"移除不需要的课件"
"清理临时文件"

# Function Call 格式
{
  "type": "file_operation", 
  "action": "delete_file",
  "params": {
    "filename": "xxx.pdf",
    "force": true | false
  }
}
```

### 2. 课程文件夹管理类 (Course Folder Management)

#### 2.1 创建课程文件夹
```bash
# 自然语言示例
"创建一个新的课程文件夹叫'机器学习'"
"为计算机视觉课程建立文件夹"
"添加课程目录：数据结构与算法"

# Function Call 格式
{
  "type": "course_operation",
  "action": "create_folder",
  "params": {
    "folder_name": "机器学习",
    "description": "机器学习相关课程资料"
  }
}
```

#### 2.2 重命名课程文件夹
```bash
# 自然语言示例
"将'机器学习'重命名为'深度学习'"
"修改课程文件夹名称"

# Function Call 格式
{
  "type": "course_operation",
  "action": "rename_folder", 
  "params": {
    "folder_id": "course-123",
    "new_name": "深度学习"
  }
}
```

#### 2.3 删除课程文件夹
```bash
# 自然语言示例
"删除'旧课程'文件夹"
"移除不需要的课程目录"

# Function Call 格式
{
  "type": "course_operation",
  "action": "delete_folder",
  "params": {
    "folder_id": "course-123",
    "confirm": true
  }
}
```

### 3. 展板管理类 (Board Management)

#### 3.1 创建展板
```bash
# 自然语言示例
"为'机器学习'课程创建一个新展板"
"建立学习展板：神经网络基础"
"开启新的工作空间"

# Function Call 格式
{
  "type": "board_operation",
  "action": "create_board",
  "params": {
    "board_name": "神经网络基础",
    "course_folder": "机器学习",
    "auto_open": true
  }
}
```

#### 3.2 打开/切换展板
```bash
# 自然语言示例
"打开展板：神经网络基础"
"切换到深度学习展板"
"进入数据科学工作区"

# Function Call 格式
{
  "type": "board_operation",
  "action": "open_board",
  "params": {
    "board_id": "board-123" | "board_name": "神经网络基础"
  }
}
```

#### 3.3 关闭/删除展板
```bash
# 自然语言示例
"关闭当前展板"
"删除'测试展板'"
"清理不需要的工作空间"

# Function Call 格式
{
  "type": "board_operation",
  "action": "close_board" | "delete_board",
  "params": {
    "board_id": "board-123",
    "save_before_close": true
  }
}
```

### 4. PDF窗口管理类 (PDF Window Management)

#### 4.1 打开PDF
```bash
# 自然语言示例
"打开机器学习.pdf"
"在展板上显示深度学习教程.pdf"
"加载课件文件"

# Function Call 格式
{
  "type": "window_operation",
  "action": "open_pdf",
  "params": {
    "filename": "机器学习.pdf",
    "page": 1,
    "position": "auto"
  }
}
```

#### 4.2 PDF导航控制
```bash
# 自然语言示例
"翻到第5页"
"下一页"
"回到首页"
"跳转到最后一页"

# Function Call 格式
{
  "type": "navigation",
  "action": "goto_page" | "next_page" | "prev_page",
  "params": {
    "page": 5,  // 仅当action为goto_page时需要
    "pdf_window_id": "pdf-window-123"  // 可选，默认为当前活跃窗口
  }
}
```

#### 4.3 关闭PDF窗口
```bash
# 自然语言示例
"关闭PDF窗口"
"移除当前课件"
"清理展板"

# Function Call 格式
{
  "type": "window_operation",
  "action": "close_window",
  "params": {
    "window_id": "pdf-window-123" | "all",
    "window_type": "pdf" | "note" | "all"
  }
}
```

### 5. 笔记和注释管理类 (Notes & Annotations)

#### 5.1 生成页面注释
```bash
# 自然语言示例
"为当前页面生成注释"
"解释第3页的内容"
"使用视觉识别分析这一页"

# Function Call 格式
{
  "type": "content_generation",
  "action": "generate_annotation",
  "params": {
    "filename": "机器学习.pdf",
    "page": 3,
    "force_vision": true | false,
    "annotation_style": "detailed" | "keywords" | "translation" | "custom"
  }
}
```

#### 5.2 改进现有注释
```bash
# 自然语言示例
"改进这个注释，增加更多详细解释"
"简化当前注释"
"用关键词风格重写注释"

# Function Call 格式
{
  "type": "content_generation", 
  "action": "improve_annotation",
  "params": {
    "annotation_id": "annotation-123",
    "improve_request": "增加更多详细解释",
    "target_style": "detailed"
  }
}
```

#### 5.3 生成PDF总笔记
```bash
# 自然语言示例
"为整本PDF生成学习笔记"
"创建课件总结"
"生成知识要点梳理"

# Function Call 格式
{
  "type": "content_generation",
  "action": "generate_pdf_note", 
  "params": {
    "filename": "机器学习.pdf",
    "note_type": "summary" | "detailed" | "outline",
    "include_annotations": true
  }
}
```

#### 5.4 笔记窗口管理
```bash
# 自然语言示例
"打开笔记编辑器"
"创建新笔记"
"保存当前笔记"

# Function Call 格式
{
  "type": "window_operation",
  "action": "open_note_editor",
  "params": {
    "note_type": "user_note" | "ai_generated",
    "content": "",
    "position": "auto"
  }
}
```

### 6. 展板笔记管理类 (Board Notes)

#### 6.1 生成展板笔记
```bash
# 自然语言示例
"生成整个展板的学习笔记"
"总结当前工作空间的内容"
"创建综合性笔记"

# Function Call 格式
{
  "type": "content_generation",
  "action": "generate_board_note",
  "params": {
    "board_id": "board-123",
    "include_pdfs": true,
    "include_annotations": true,
    "note_style": "comprehensive" | "summary" | "outline"
  }
}
```

#### 6.2 改进展板笔记
```bash
# 自然语言示例
"改进展板笔记，增加实例说明"
"优化学习笔记的结构"

# Function Call 格式
{
  "type": "content_generation",
  "action": "improve_board_note", 
  "params": {
    "board_id": "board-123",
    "current_note": "...",
    "improve_request": "增加实例说明"
  }
}
```

### 7. 智能问答类 (Q&A System)

#### 7.1 PDF问答
```bash
# 自然语言示例
"这个PDF讲的主要内容是什么？"
"什么是卷积神经网络？"
"解释一下第5页的公式"

# Function Call 格式
{
  "type": "qa_system",
  "action": "ask_pdf_question",
  "params": {
    "filename": "机器学习.pdf",
    "question": "什么是卷积神经网络？",
    "context_page": 5
  }
}
```

#### 7.2 展板问答
```bash
# 自然语言示例
"根据当前展板内容，总结学习要点"
"这些材料之间有什么联系？"

# Function Call 格式
{
  "type": "qa_system", 
  "action": "ask_board_question",
  "params": {
    "board_id": "board-123",
    "question": "总结学习要点"
  }
}
```

### 8. 专家LLM交互类 (Expert LLM Interaction)

#### 8.1 启动专家对话
```bash
# 自然语言示例
"请专家分析当前PDF内容"
"启动智能学习助手"
"咨询AI专家关于这个话题"

# Function Call 格式
{
  "type": "expert_interaction",
  "action": "start_expert_chat",
  "params": {
    "board_id": "board-123",
    "initial_question": "分析当前PDF内容",
    "expert_mode": "intelligent" | "simple"
  }
}
```

#### 8.2 专家任务执行
```bash
# 自然语言示例
"让专家生成学习计划"
"请AI分析文档结构"
"执行智能内容解析"

# Function Call 格式
{
  "type": "expert_interaction",
  "action": "submit_expert_task",
  "params": {
    "board_id": "board-123", 
    "task_type": "analysis" | "generation" | "planning",
    "task_description": "生成学习计划"
  }
}
```

### 9. 系统管理类 (System Management)

#### 9.1 状态查询
```bash
# 自然语言示例
"查看当前系统状态"
"显示应用程序信息"
"检查API配置"

# Function Call 格式
{
  "type": "system_query",
  "action": "get_system_status",
  "params": {
    "include_details": true,
    "check_api": true
  }
}
```

#### 9.2 配置管理
```bash
# 自然语言示例
"设置注释风格为关键词模式"
"修改默认生成参数"
"配置专家LLM设置"

# Function Call 格式
{
  "type": "system_config",
  "action": "set_annotation_style",
  "params": {
    "board_id": "board-123",
    "style": "keywords" | "detailed" | "translation" | "custom",
    "custom_prompt": "..."
  }
}
```

### 10. 多步任务类 (Multi-step Tasks)

#### 10.1 任务规划
```bash
# 自然语言示例
"帮我制定机器学习的学习计划"
"创建完整的课程学习方案"
"规划PDF分析和笔记生成流程"

# Function Call 格式
{
  "type": "task_planning",
  "action": "plan_learning_workflow",
  "params": {
    "subject": "机器学习",
    "materials": ["机器学习.pdf", "深度学习.pdf"],
    "learning_goals": ["理解基本概念", "掌握实践方法"]
  }
}
```

#### 10.2 批量操作
```bash
# 自然语言示例
"为所有PDF生成注释"
"批量创建课程结构"
"导入并处理多个文件"

# Function Call 格式
{
  "type": "batch_operation",
  "action": "batch_generate_annotations",
  "params": {
    "files": ["file1.pdf", "file2.pdf"],
    "operation_type": "annotation",
    "parallel": true
  }
}
```

## 🔧 Function Call 执行机制

### 1. 前端接收与确认
```javascript
// 控制台接收Function Call
if (result.function_calls) {
  result.function_calls.forEach(call => {
    // 显示即将执行的操作
    showOperationConfirmation(call);
    
    // 执行操作
    executeOperation(call);
  });
}
```

### 2. 操作分发机制
```javascript
function executeOperation(functionCall) {
  const { type, action, params } = functionCall;
  
  switch(type) {
    case 'file_operation':
      return handleFileOperation(action, params);
    case 'board_operation':
      return handleBoardOperation(action, params);
    case 'window_operation':
      return handleWindowOperation(action, params);
    case 'content_generation':
      return handleContentGeneration(action, params);
    // ... 其他操作类型
  }
}
```

### 3. 状态反馈机制
```javascript
// 执行结果反馈给管家LLM
function sendOperationResult(functionCall, result) {
  apiClient.post('/butler/operation-result', {
    function_call: functionCall,
    result: result,
    timestamp: new Date().toISOString()
  });
}
```

## 🎯 指令优化策略

### 1. 自然语言理解增强
- 支持多种表达方式的同一意图
- 模糊匹配和智能纠错
- 上下文理解和指代消解

### 2. 指令学习机制
- 用户习惯记录
- 常用指令快捷化
- 个性化指令别名

### 3. 错误处理与反馈
- 清晰的错误提示
- 操作建议和修正
- 撤销和重做支持

## 📈 扩展性设计

### 1. 插件化指令系统
```javascript
// 注册新指令类型
registerCommandType('custom_operation', {
  actions: ['custom_action1', 'custom_action2'],
  handler: customOperationHandler
});
```

### 2. 动态指令发现
```javascript
// 扫描可用操作
const availableOperations = discoverAvailableOperations();
updateCommandSuggestions(availableOperations);
```

### 3. 指令版本管理
```javascript
// 支持向后兼容的指令格式
const commandVersion = '1.0';
const compatibilityLayer = new CommandCompatibility(commandVersion);
```

## 🚀 实施路线图

### Phase 1: 基础指令体系
- 文件管理指令
- 基础导航指令
- 简单内容生成指令

### Phase 2: 高级功能指令
- 专家LLM交互指令
- 复杂内容操作指令
- 系统配置指令

### Phase 3: 智能化增强
- 多步任务规划
- 上下文理解优化
- 个性化学习

### Phase 4: 生态扩展
- 插件系统支持
- 第三方指令集成
- API开放平台

---

这个指令体系设计确保了用户可以通过自然语言完成所有界面操作，为管家LLM的Function Calling提供了完整的落地基础。 