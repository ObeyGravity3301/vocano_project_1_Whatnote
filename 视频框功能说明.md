# WhatNote 视频框功能说明

## 功能概述

视频框是WhatNote系统中的一个新功能，允许用户在展板中添加、播放和管理视频内容。这个功能基于现有的图片框架构设计，提供了完整的视频上传、播放和管理功能。

## 主要特性

### 🎬 视频格式支持
- **支持格式**: MP4, WebM, OGG, AVI, MOV, WMV, FLV, MKV, M4V
- **文件大小限制**: 最大100MB
- **网络视频**: 支持直接粘贴视频URL

### 🎮 播放控制
- **原生HTML5播放器**: 使用浏览器内置的video标签
- **播放控制**: 播放/暂停、进度条、音量控制
- **响应式设计**: 自动适应窗口大小
- **全屏支持**: 支持全屏播放模式

### 📤 上传方式
1. **拖拽上传**: 直接拖拽视频文件到上传区域
2. **点击选择**: 点击按钮选择本地视频文件
3. **URL粘贴**: 支持粘贴网络视频URL（YouTube、Vimeo、Bilibili等）

### 🎨 界面特性
- **蓝色标题栏**: 视频窗口使用蓝色标题栏标识
- **悬浮控制**: 鼠标悬停显示额外控制按钮
- **复制URL**: 一键复制视频URL到剪贴板
- **删除确认**: 删除视频前需要确认

## 技术架构

### 后端API

#### 1. 视频上传API
```
POST /api/videos/upload
Content-Type: multipart/form-data

响应格式:
{
  "success": true,
  "url": "/api/videos/view/filename.mp4",
  "path": "uploads/videos/filename.mp4",
  "size": 1024000,
  "message": "视频上传成功"
}
```

#### 2. 视频查看API
```
GET /api/videos/view/{filename}
响应: 视频文件流，支持Range请求
```

### 前端组件

#### VideoWindow.js
- **位置**: `frontend/src/components/VideoWindow.js`
- **样式**: `frontend/src/components/VideoWindow.css`
- **功能**: 视频上传、播放、管理的完整UI组件

#### 主要功能:
- 文件验证和上传
- 视频播放状态管理
- 响应式布局适配
- 错误处理和用户反馈

### 控制台命令支持

#### 创建视频窗口
```bash
window create video "我的视频窗口"
```

#### 设置视频内容
```bash
# 本地文件
window video "我的视频窗口" "C:/path/to/video.mp4"

# 网络URL
window video "我的视频窗口" "https://example.com/video.mp4"

# 系统文件
window video "我的视频窗口" "uploaded/filename.mp4"
```

#### 查看窗口列表
```bash
window list
```

## 使用指南

### 1. 创建视频窗口

**方法一: 通过控制台**
1. 打开管家助手控制台
2. 输入命令: `window create video "视频标题"`
3. 系统会创建一个新的视频窗口

**方法二: 通过前端界面**
1. 在展板中右键菜单选择"添加视频窗口"
2. 或使用快捷键创建

### 2. 上传视频

**拖拽上传:**
1. 将视频文件直接拖拽到视频窗口的上传区域
2. 系统自动验证格式和大小
3. 上传完成后自动开始播放

**选择文件:**
1. 点击"选择视频文件"按钮
2. 在文件对话框中选择视频
3. 确认上传

**粘贴URL:**
1. 复制视频URL到剪贴板
2. 在视频窗口中按Ctrl+V粘贴
3. 系统自动设置视频源

### 3. 播放控制

- **播放/暂停**: 点击视频或使用控制按钮
- **进度控制**: 拖拽进度条跳转到指定位置
- **音量控制**: 使用音量滑块调节音量
- **全屏播放**: 双击视频或使用全屏按钮

### 4. 管理功能

- **复制URL**: 点击复制按钮获取视频链接
- **删除视频**: 点击删除按钮（需要确认）
- **窗口调整**: 拖拽调整窗口大小和位置

## 配置说明

### 文件存储
- **存储路径**: `uploads/videos/`
- **命名规则**: `原文件名_时间戳.扩展名`
- **自动创建**: 系统自动创建必要的目录

### 安全设置
- **文件类型验证**: 严格验证文件扩展名
- **大小限制**: 100MB上传限制
- **路径安全**: 防止路径遍历攻击

## 故障排除

### 常见问题

**1. 视频无法播放**
- 检查视频格式是否支持
- 确认文件没有损坏
- 检查网络连接（网络视频）

**2. 上传失败**
- 检查文件大小是否超过100MB
- 确认文件格式在支持列表中
- 检查磁盘空间是否充足

**3. 控制台命令无效**
- 确认窗口ID或名称正确
- 检查文件路径是否存在
- 验证命令语法

### 调试信息
- 查看浏览器控制台的错误信息
- 检查后端日志文件
- 使用网络面板查看API请求状态

## 扩展功能

### 未来计划
- **字幕支持**: 添加字幕文件上传和显示
- **视频剪辑**: 基本的视频剪辑功能
- **播放列表**: 支持多视频播放列表
- **直播流**: 支持RTMP等直播流协议
- **视频标注**: 在视频上添加时间戳标注

### 自定义开发
- 扩展支持的视频格式
- 集成第三方视频服务
- 添加视频转码功能
- 实现视频缩略图生成

## 技术细节

### 依赖项
- **前端**: React, Antd, HTML5 Video API
- **后端**: FastAPI, Python文件处理
- **存储**: 本地文件系统

### 性能优化
- **懒加载**: 视频组件按需加载
- **Range请求**: 支持视频流式传输
- **缓存策略**: 浏览器缓存优化
- **压缩**: 自动文件压缩（可选）

### 兼容性
- **浏览器**: 支持现代浏览器（Chrome, Firefox, Safari, Edge）
- **移动端**: 响应式设计，支持移动设备
- **操作系统**: 跨平台支持

---

## 总结

视频框功能为WhatNote系统增加了强大的多媒体支持，使用户能够在学习和工作中更好地整合视频内容。通过简洁的界面和强大的功能，用户可以轻松管理和播放各种格式的视频文件。

如有问题或建议，请通过系统反馈功能联系开发团队。 