# åŒçª—å£åˆ›å»ºé—®é¢˜ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°
ç”¨æˆ·åæ˜ ç‚¹å‡»å³é”®èœå•åˆ›å»ºçª—å£æ—¶ï¼Œä¼šä¸€æ¬¡æ€§åˆ›å»ºä¸¤ä¸ªç›¸åŒçš„çª—å£ï¼Œè¿èƒŒäº†ç”¨æˆ·çš„é¢„æœŸã€‚ä»æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°æ¯æ¬¡èœå•å‘½ä»¤éƒ½è¢«æ‰§è¡Œäº†ä¸¤æ¬¡ã€‚

## é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
1. **åŒé‡äº‹ä»¶è§¦å‘**ï¼šGlobalContextMenuç»„ä»¶åŒæ—¶è§¦å‘äº†è‡ªå®šä¹‰äº‹ä»¶å’Œå›è°ƒå‡½æ•°
2. **äº‹ä»¶ç›‘å¬å™¨é‡å¤ç»‘å®š**ï¼šApp.jsä¸­çš„äº‹ä»¶ç›‘å¬å™¨éšç€çŠ¶æ€æ›´æ–°è¢«é‡å¤ç»‘å®š
3. **é˜²é‡å¤æœºåˆ¶å¤±æ•ˆ**ï¼š`creatingWindow` æ ‡è®°æ²¡æœ‰æ­£ç¡®é˜»æ­¢é‡å¤è¯·æ±‚

### å…·ä½“é—®é¢˜ç‚¹
ä»æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼š
```
App.js:3849 å¤„ç†å³é”®èœå•å‘½ä»¤: create_text_window
App.js:3849 å¤„ç†å³é”®èœå•å‘½ä»¤: create_text_window  // ç«‹å³é‡å¤
```

æ¯æ¬¡ç‚¹å‡»éƒ½ä¼šç«‹å³æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„å‘½ä»¤ï¼Œå¯¼è‡´åˆ›å»ºä¸¤ä¸ªçª—å£ã€‚

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤GlobalContextMenuåŒé‡è§¦å‘
**é—®é¢˜ä»£ç **ï¼š
```javascript
// åŒæ—¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶å’Œå›è°ƒ
window.dispatchEvent(commandEvent);
if (onCommand) {
  onCommand(item.command, item.data || targetData);
}
```

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```javascript
// ä¼˜å…ˆä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œé¿å…åŒé‡è§¦å‘
if (onCommand) {
  console.log('ğŸ¯ [èœå•] ä½¿ç”¨å›è°ƒå‡½æ•°æ‰§è¡Œå‘½ä»¤');
  onCommand(item.command, item.data || targetData);
} else {
  console.log('ğŸ¯ [èœå•] ä½¿ç”¨å…¨å±€äº‹ä»¶æ‰§è¡Œå‘½ä»¤');
  const commandEvent = new CustomEvent('menu-command', {
    detail: { command: item.command, data: item.data || targetData }
  });
  window.dispatchEvent(commandEvent);
}
```

### 2. ç§»é™¤App.jsä¸­çš„é‡å¤äº‹ä»¶ç›‘å¬
**ç§»é™¤çš„ä»£ç **ï¼š
```javascript
useEffect(() => {
  const handleMenuCommand = (event) => {
    const { command, data } = event.detail;
    console.log('æ”¶åˆ°å…¨å±€èœå•å‘½ä»¤äº‹ä»¶:', command, data);
    handleContextMenuCommand(command, data);
  };

  window.addEventListener('menu-command', handleMenuCommand);
  
  return () => {
    window.removeEventListener('menu-command', handleMenuCommand);
  };
}, [currentFile, courseFiles]);
```

ç°åœ¨åªä½¿ç”¨ `onCommand` å›è°ƒæ–¹å¼ï¼Œé¿å…äº‹ä»¶é‡å¤ã€‚

### 3. å¢å¼ºé˜²é‡å¤åˆ›å»ºæœºåˆ¶
**åŸæœ‰æœºåˆ¶**ï¼š
```javascript
const [creatingWindow, setCreatingWindow] = useState(false);
```

**æ–°çš„æœºåˆ¶**ï¼š
```javascript
const [creatingWindows, setCreatingWindows] = useState(new Set());

const createKey = `${boardId}-${windowType}`;
if (creatingWindows.has(createKey)) {
  console.log(`ğŸš« æ­£åœ¨åˆ›å»º${windowType}çª—å£ï¼Œè·³è¿‡é‡å¤è¯·æ±‚`);
  return;
}
```

ä½¿ç”¨æ›´ç²¾ç¡®çš„æ ‡è®°ï¼Œé’ˆå¯¹ä¸åŒå±•æ¿å’Œçª—å£ç±»å‹åˆ†åˆ«é˜²é‡å¤ã€‚ 